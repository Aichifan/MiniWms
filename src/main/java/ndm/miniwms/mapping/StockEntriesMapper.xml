<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ndm.miniwms.dao.StockEntriesMapper">
	<resultMap id="BaseResultMap" type="ndm.miniwms.pojo.StockEntries">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="inventory_id" property="inventoryId" jdbcType="INTEGER" />
		<result column="item_id" property="itemId" jdbcType="INTEGER" />
		<result column="in_id" property="inId" jdbcType="INTEGER" />
		<result column="out_id" property="outId" jdbcType="INTEGER" />
		<result column="check_id" property="checkId" jdbcType="INTEGER" />
		<result column="opening_stock" property="openingStock" jdbcType="INTEGER" />
		<result column="closing_stock" property="closingStock" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="operator_id" property="operatorId" jdbcType="INTEGER" />
	</resultMap>

	<select id="all" resultMap="BaseResultMap">
		select * from stock_entries
	</select>

	<select id="selectTab" resultMap="BaseResultMap1">
		select * from stock_entries
	</select>
	<resultMap id="BaseResultMap1" type="ndm.miniwms.pojo.StockEntries">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="inventory_id" property="inventoryId" jdbcType="INTEGER" />
		<result column="item_id" property="itemId" jdbcType="INTEGER" />
		<result column="in_id" property="inId" jdbcType="INTEGER" />
		<result column="out_id" property="outId" jdbcType="INTEGER" />
		<result column="check_id" property="checkId" jdbcType="INTEGER" />
		<result column="opening_stock" property="openingStock" jdbcType="INTEGER" />
		<result column="closing_stock" property="closingStock" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="operator_id" property="operatorId" jdbcType="INTEGER" />
		<!--公司 -->
		<association property="companyDetails" column="company_id" select="getcompny"/>
		<!--库存id -->
		<association property="stockInventory" column="inventory_id" select="getinventory"/>
		<!--商品id -->
		<association property="stockItem" column="item_id" select="getitem"/>
		<!--入库单id -->
		<association property="stockIn" column="in_id" select="getstockIn"/>
		<!--出库单id -->
		<association property="stockOut" column="out_id" select="getstockOut"/>
		<!--盘点id -->
		<association property="stockCheck" column="check_id" select="getstockCheck"/>
		<!--操作人id  （用户）-->
		<association property="companyUser" column="operator_id" select="getcompanyUser"/>
	</resultMap>
	<resultMap id="CompanyResultMap" type="ndm.miniwms.pojo.CompanyDetails">
		<id column="id" property="id" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="inventoryResultMap" type="ndm.miniwms.pojo.StockInventory" >
	    <id column="id" property="id" jdbcType="INTEGER" />
	    <result column="item_id" property="itemId" jdbcType="INTEGER" />
	    <result column="last_operator_id" property="lastOperatorId" jdbcType="INTEGER" />
	    <result column="company_id" property="companyId" jdbcType="INTEGER" />
	    <result column="location_id" property="locationId" jdbcType="INTEGER" />
	    <result column="in_id" property="inId" jdbcType="INTEGER" />
	    <association property="locationDetails" column="location_id" select="getlocation"/>
	</resultMap>
	<resultMap id="stockItemResultMap" type="ndm.miniwms.pojo.StockItem">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="brand_id" property="brandId" jdbcType="INTEGER" />
		<result column="category_id" property="categoryId" jdbcType="INTEGER" />
		<result column="hazard_flag" property="hazardFlag" jdbcType="BOOLEAN" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="stockInResultMap" type="ndm.miniwms.pojo.StockIn" >
	    <id column="id" property="id" jdbcType="INTEGER" />
	    <result column="supplier_id" property="supplierId" jdbcType="INTEGER" />
	    <result column="company_id" property="companyId" jdbcType="INTEGER" />
	    <result column="user_id" property="userId" jdbcType="INTEGER" />
	    <result column="customer_billnumber" property="customerBillnumber" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="stockOutResultMap" type="ndm.miniwms.pojo.StockOut" >
	    <id column="id" property="id" jdbcType="INTEGER" />
	    <result column="consignee_id" property="consigneeId" jdbcType="INTEGER" />
	    <result column="company_id" property="companyId" jdbcType="INTEGER" />
	    <result column="user_id" property="userId" jdbcType="INTEGER" />
	    <result column="customer_billnumber" property="customerBillnumber" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="stockCheckResultMap" type="ndm.miniwms.pojo.StockCheck">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="start_at" property="startAt" jdbcType="TIMESTAMP" />
		<result column="end_at" property="endAt" jdbcType="TIMESTAMP" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="operator_id" property="operatorId" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="companyUserResultMap" type="ndm.miniwms.pojo.CompanyUser">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="locationResultMap" type="ndm.miniwms.pojo.LocationDetails">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
		<result column="company_id" property="companyId" jdbcType="INTEGER" />
	</resultMap>
	<select id = "getcompny"  parameterType="java.lang.Integer"  resultMap="CompanyResultMap" >
		select * from company_details where id=#{company_id}
 	</select>
 	 <select id="getinventory" parameterType="java.lang.Integer" resultMap="inventoryResultMap">
   		 select * from stock_inventory where id = #{inventory_id}
 	 </select>
 	 <select id="getitem" resultMap="stockItemResultMap" parameterType="java.lang.Integer">
		select * from stock_item where id = #{item_id}
	</select>
	<select id="getstockIn" resultMap="stockInResultMap" parameterType="java.lang.Integer">
    	select * from stock_in where id=#{in_id}
 	 </select>
 	 <select id="getstockOut" resultMap="stockOutResultMap" parameterType="java.lang.Integer">
    	select * from stock_out where id=#{out_id}
 	 </select>
 	 <select id="getstockCheck" resultMap="stockCheckResultMap" parameterType="java.lang.Integer">
		select * from stock_check where id=#{check_id}
	</select>
	<select id="getcompanyUser" resultMap="companyUserResultMap" parameterType="java.lang.Integer">
		select * from company_user where id=#{operator_id}
	</select>
	<select id="getlocation" resultMap="locationResultMap" parameterType="java.lang.Integer">
		select * from location_details where id=#{location_id}
	</select>
	

	<delete id="delById" parameterType="java.lang.Integer">
		delete from stock_entries
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<update id="update" parameterType="ndm.miniwms.pojo.StockEntries">
		update stock_entries set
		inventory_id = #{inventoryId},item_id = #{itemId},date = #{date},
		type
		= #{type},in_id = #{inId},out_id = #{outId},check_id =
		#{checkId},opening_stock = #{openingStock},closing_stock =
		#{closingStock},
		company_id = #{companyId},operator_id = #{operatorId}
		where id = #{id}
	</update>

	<insert id="add" parameterType="ndm.miniwms.pojo.StockEntries">
		insert into stock_entries
		(inventory_id,item_id,date,type,in_id,
		out_id,check_id,opening_stock,closing_stock,company_id,operator_id)
		values (#{inventoryId},#{itemId},#{date},#{type},#{inId},#{outId},
		#{checkId},#{openingStock},#{closingStock},#{companyId},#{operatorId})
	</insert>
</mapper>